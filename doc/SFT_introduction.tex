\chapter{Introduction}

This document describes a working prototype of the 
Surface Flux Transport model (SFT).
The SFT was developed to provide a computationaly inexpensive solver to explore
the parameter space to better understand the evolution of solar surface magnetic field 
evolution in response to the changes in source functions and transport parameters. In 
its current form the SFT is numerically stable and provides a user-friendly test-bed to 
understand how the properties of sunspots, advection profiles and diffusivity impact the
global solar surface magnetic field evolution.

The core of the SFT are written in Fortran 90. As the equations are simplified to evolve in
one dimensions, presently the code does not implement parallel communications libraries.
The SFT creates a single executable which can be compiled with netCDF libraries and run on any 
computer as long as the GNU compiler and netCDF libraries are properly installed.

\section*{Acknowledgments}

This numerical implementation of the model follows \citet{Yeates2020SoPh}. The first version of the SWMF was developed at the Institute for Astronomy (IFA) of the University of Hawaii. 

\section{System Requirements}

In order to install and run the SFT 1D the following minimum system
requirements apply.
\begin{itemize}
\item The SFT runs only under the UNIX/Linux operating systems.  This now
  includes Macintosh system 10.x because it is based on BSD UNIX.  It does not run under any Microsoft Windows operating system.
\item A GNU FORTRAN compiler must be installed.
\item The file writing subroutine use netCDF output. For these the serial/parallel version of the netCDF library has to be installed. 
\item In order to generate the documentation, LaTex has to be installed.
\end{itemize}
As the code solves the magnetic field evolution in only one dimension, it does not need huge computing power or higher memory load. It can run on a single processor with a nominal RAM memory.

In addition to the above requirements, the SFT output is typically
visualized using Python. Other visualization packages may also be used, but the output file formats should be suported by those visualization softwares.

\chapter{Quick Start}

\section{A Brief Description of the SFT 1D code}

The distribution in the form of the compressed tar image
includes the SFT source code.
The top level directory contains the following subdirectories:
\begin{itemize}\itemsep=0pt
\item {\tt doc}     - the documentation directory 
\item {\tt bipole\_file} - the bipole properties to generate the source terms for the model
\item {\tt input\_files}  - initial magnetic field configuration for the SFT code, typically a synoptic magnetogram interpolated into the targeted sine-latitude -- longitude grid 
\end{itemize}
and the following files
\begin{itemize}\itemsep=0pt
\item {\tt evolSFT.f90}     - a short instruction on installation and usage
\item {\tt flows.f90}     - description of CON parameters
\item {\tt grid\-SFT.f90}   - to construct the grid of the solver
\item {\tt init\_condition.f90} - code to set-up the initial conditions
\item {\tt initial\_Parameters.nml} - user input of the initial parameter values for the variables
\item {\tt Makefile}      - the main makefile
\item {\tt output.f90}  - subroutine to write the files in ASCII format
\item {\tt main.f90} - the main code
\item {\tt variables.f90} - definition of the variables to be used in the code
\item {\tt write\_data.f90} - code to write the output data in netCDF format
\end{itemize}

\section{General Hints}

\subsubsection{Getting help with the Makefile}

You can find all the possible
targets  that can be built by typing
\begin{verbatim}
make help
\end{verbatim}

\subsubsection{Compiling the code}
Before going to compile the code it is essential to modify a few things in the \texttt{Makefile}.
Currently, the fortran compiler and the paths of the netCDF libraries are set to this path.
\begin{verbatim}
# Set FORTRAN90 compiler
FC = gfortran

# Location of files for netcdf library
NETCDF = -I/usr/local/netcdf/include/
NETCDFLIB = -L/usr/local/netcdf/lib/ -lnetcdff
\end{verbatim}
You need to change the paths and the compiler options according to your system. Once this is correctly specified, compile the code by typing \texttt{make}. This will create two additional sub-directories; \texttt{bin, obj}. The executable \texttt{SFT\_1D} will be created in the bin directory if there are no errors in the compilation process.

\subsubsection{Running the code}
Surface flux transport model requires two major input from the user. First being the meridional flow profile and magnetic diffusivity ($\eta$). And the second being the source functions i.e., bipole properties which are added to the evolution at the time when they appear on the solar photosphere. 
\begin{itemize}
    \item Bipolar Magnetic Region (BMRs) properties are pre-written to an ASCII file and saved in \texttt{bipole\_file/all\_bmrs.txt}.
    \item Meridional flow profile is defined in the subroutine \texttt{MC\_flow} contained in \texttt{flows.f90} file. 
    \item Magnetic diffusivity ($\eta$) is defined in units of km$^2$/s in the \texttt{initial\_Parameters.nml} file.
\end{itemize}
These parameters are passed to the code using a \texttt{namelist} file \texttt{initial\_Parameters.nml}. This will create the necessary subdirectories for saving the output and execute the code based on the selected parameters. After compiling the code, type \texttt{>./bin/SFT\_1D initial\_Parameters.nml} to run the simulation.

There is a sample plotting file (\texttt{plot\_results.py}) is also distributed with this version of the code along with some supporting files. If all the necessary python packages are available, this script will generate the butterfly diagram, comparative plot between the HMI polar field and the SFT polar field and the dipole moment. With the current set of initial conditions, the example of these plots are provided with this version of the code. 
